(function (exports) {
'use strict';

class AudioLoader {
	constructor(url, opts = {}) {
		this.url = url;

		this.context = new AudioContext();

		this.analyser = this.context.createAnalyser();
		this.analyser.fftSize = opts.fftSize ? opts.fftSize : 1024;
		this.analyser.smoothingTimeContext = opts.smoothingTimeContext ?
			opts.smoothingTimeContext : 0.8;
		this.analyser.connect(this.context.destination);

		this.source = this.context.createBufferSource();
		this.source.connect(this.analyser);

		this.data = new Uint8Array(this.analyser.frequencyBinCount);
	}

	load(url = '') {
		return new Promise((resolve, reject) => {
			if (url && this.url !== url) {
				this.url = url;
			}

			if (!this.url) {
				reject('not url specified');
			}

			const req = new XMLHttpRequest();
			req.onerror = e => reject(e);
			req.onload = () => {
				this.context.decodeAudioData(req.response, buffer => {
					this.source.buffer = buffer;

					resolve(this.source);
				});
			};
			req.responseType = 'arraybuffer';
			req.open('GET', this.url, true);
			req.send();
		});
	}
}

function load(url, opts = {}) {
	const l = new AudioLoader(url, opts);
	return l.load();
}

exports.load = load;

}((this.AudioLoader = this.AudioLoader || {})));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVkaW9sb2FkZXIuanMiLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlxuXG5jbGFzcyBBdWRpb0xvYWRlciB7XG5cdGNvbnN0cnVjdG9yKHVybCwgb3B0cyA9IHt9KSB7XG5cdFx0dGhpcy51cmwgPSB1cmw7XG5cblx0XHR0aGlzLmNvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KCk7XG5cblx0XHR0aGlzLmFuYWx5c2VyID0gdGhpcy5jb250ZXh0LmNyZWF0ZUFuYWx5c2VyKCk7XG5cdFx0dGhpcy5hbmFseXNlci5mZnRTaXplID0gb3B0cy5mZnRTaXplID8gb3B0cy5mZnRTaXplIDogMTAyNDtcblx0XHR0aGlzLmFuYWx5c2VyLnNtb290aGluZ1RpbWVDb250ZXh0ID0gb3B0cy5zbW9vdGhpbmdUaW1lQ29udGV4dCA/XG5cdFx0XHRvcHRzLnNtb290aGluZ1RpbWVDb250ZXh0IDogMC44O1xuXHRcdHRoaXMuYW5hbHlzZXIuY29ubmVjdCh0aGlzLmNvbnRleHQuZGVzdGluYXRpb24pO1xuXG5cdFx0dGhpcy5zb3VyY2UgPSB0aGlzLmNvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG5cdFx0dGhpcy5zb3VyY2UuY29ubmVjdCh0aGlzLmFuYWx5c2VyKTtcblxuXHRcdHRoaXMuZGF0YSA9IG5ldyBVaW50OEFycmF5KHRoaXMuYW5hbHlzZXIuZnJlcXVlbmN5QmluQ291bnQpO1xuXHR9XG5cblx0bG9hZCh1cmwgPSAnJykge1xuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRpZiAodXJsICYmIHRoaXMudXJsICE9PSB1cmwpIHtcblx0XHRcdFx0dGhpcy51cmwgPSB1cmw7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghdGhpcy51cmwpIHtcblx0XHRcdFx0cmVqZWN0KCdub3QgdXJsIHNwZWNpZmllZCcpO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblx0XHRcdHJlcS5vbmVycm9yID0gZSA9PiByZWplY3QoZSk7XG5cdFx0XHRyZXEub25sb2FkID0gKCkgPT4ge1xuXHRcdFx0XHR0aGlzLmNvbnRleHQuZGVjb2RlQXVkaW9EYXRhKHJlcS5yZXNwb25zZSwgYnVmZmVyID0+IHtcblx0XHRcdFx0XHR0aGlzLnNvdXJjZS5idWZmZXIgPSBidWZmZXI7XG5cblx0XHRcdFx0XHRyZXNvbHZlKHRoaXMuc291cmNlKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9O1xuXHRcdFx0cmVxLnJlc3BvbnNlVHlwZSA9ICdhcnJheWJ1ZmZlcic7XG5cdFx0XHRyZXEub3BlbignR0VUJywgdGhpcy51cmwsIHRydWUpO1xuXHRcdFx0cmVxLnNlbmQoKTtcblx0XHR9KTtcblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9hZCh1cmwsIG9wdHMgPSB7fSkge1xuXHRjb25zdCBsID0gbmV3IEF1ZGlvTG9hZGVyKHVybCwgb3B0cyk7XG5cdHJldHVybiBsLmxvYWQoKTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSxNQUFNLFdBQVcsQ0FBQztDQUNqQixXQUFXLENBQUMsR0FBRyxFQUFFLElBQUksR0FBRyxFQUFFLEVBQUU7RUFDM0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7O0VBRWYsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDOztFQUVsQyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLENBQUM7RUFDOUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztFQUMzRCxJQUFJLENBQUMsUUFBUSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxvQkFBb0I7R0FDN0QsSUFBSSxDQUFDLG9CQUFvQixHQUFHLEdBQUcsQ0FBQztFQUNqQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDOztFQUVoRCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztFQUNoRCxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7O0VBRW5DLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0VBQzVEOztDQUVELElBQUksQ0FBQyxHQUFHLEdBQUcsRUFBRSxFQUFFO0VBQ2QsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLEtBQUs7R0FDdkMsSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLEdBQUcsS0FBSyxHQUFHLEVBQUU7SUFDNUIsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFDZjs7R0FFRCxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRTtJQUNkLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0lBQzVCOztHQUVELE1BQU0sR0FBRyxHQUFHLElBQUksY0FBYyxFQUFFLENBQUM7R0FDakMsR0FBRyxDQUFDLE9BQU8sR0FBRyxDQUFDLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0dBQzdCLEdBQUcsQ0FBQyxNQUFNLEdBQUcsTUFBTTtJQUNsQixJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLE1BQU0sSUFBSTtLQUNwRCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7O0tBRTVCLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDckIsQ0FBQyxDQUFDO0lBQ0gsQ0FBQztHQUNGLEdBQUcsQ0FBQyxZQUFZLEdBQUcsYUFBYSxDQUFDO0dBQ2pDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUM7R0FDaEMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0dBQ1gsQ0FBQyxDQUFDO0VBQ0g7Q0FDRDs7QUFFRCxBQUFPLFNBQVMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLEdBQUcsRUFBRSxFQUFFO0NBQ3BDLE1BQU0sQ0FBQyxHQUFHLElBQUksV0FBVyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztDQUNyQyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztDQUNoQiw7Oyw7OyJ9
