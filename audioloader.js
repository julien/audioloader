(function (exports) {
'use strict';

var AudioLoader = function AudioLoader(url, opts) {
	if ( opts === void 0 ) opts = {};

	this.url = url;

	this.context = new AudioContext();

	this.analyser = this.context.createAnalyser();
	this.analyser.fftSize = opts.fftSize ? opts.fftSize : 1024;
	this.analyser.smoothingTimeContext = opts.smoothingTimeContext ?
		opts.smoothingTimeContext : 0.8;
	this.analyser.connect(this.context.destination);

	this.source = this.context.createBufferSource();
	this.source.connect(this.analyser);

	this.data = new Uint8Array(this.analyser.frequencyBinCount);
};

AudioLoader.prototype.load = function load (url) {
		var this$1 = this;
		if ( url === void 0 ) url = '';

	return new Promise(function (resolve, reject) {
		if (url && this$1.url !== url) {
			this$1.url = url;
		}

		if (!this$1.url) {
			reject('not url specified');
		}

		var req = new XMLHttpRequest();
		req.onerror = function (e) { return reject(e); };
		req.onload = function () {
			this$1.context.decodeAudioData(req.response, function (buffer) {
				this$1.source.buffer = buffer;

				resolve(this$1.source);
			});
		};
		req.responseType = 'arraybuffer';
		req.open('GET', this$1.url, true);
		req.send();
	});
};

function load(url, opts) {
	if ( opts === void 0 ) opts = {};

	var l = new AudioLoader(url, opts);
	return l.load();
}

exports.load = load;

}((this.AudioLoader = this.AudioLoader || {})));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlxuXG5jbGFzcyBBdWRpb0xvYWRlciB7XG5cdGNvbnN0cnVjdG9yKHVybCwgb3B0cyA9IHt9KSB7XG5cdFx0dGhpcy51cmwgPSB1cmw7XG5cblx0XHR0aGlzLmNvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KCk7XG5cblx0XHR0aGlzLmFuYWx5c2VyID0gdGhpcy5jb250ZXh0LmNyZWF0ZUFuYWx5c2VyKCk7XG5cdFx0dGhpcy5hbmFseXNlci5mZnRTaXplID0gb3B0cy5mZnRTaXplID8gb3B0cy5mZnRTaXplIDogMTAyNDtcblx0XHR0aGlzLmFuYWx5c2VyLnNtb290aGluZ1RpbWVDb250ZXh0ID0gb3B0cy5zbW9vdGhpbmdUaW1lQ29udGV4dCA/XG5cdFx0XHRvcHRzLnNtb290aGluZ1RpbWVDb250ZXh0IDogMC44O1xuXHRcdHRoaXMuYW5hbHlzZXIuY29ubmVjdCh0aGlzLmNvbnRleHQuZGVzdGluYXRpb24pO1xuXG5cdFx0dGhpcy5zb3VyY2UgPSB0aGlzLmNvbnRleHQuY3JlYXRlQnVmZmVyU291cmNlKCk7XG5cdFx0dGhpcy5zb3VyY2UuY29ubmVjdCh0aGlzLmFuYWx5c2VyKTtcblxuXHRcdHRoaXMuZGF0YSA9IG5ldyBVaW50OEFycmF5KHRoaXMuYW5hbHlzZXIuZnJlcXVlbmN5QmluQ291bnQpO1xuXHR9XG5cblx0bG9hZCh1cmwgPSAnJykge1xuXHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRpZiAodXJsICYmIHRoaXMudXJsICE9PSB1cmwpIHtcblx0XHRcdFx0dGhpcy51cmwgPSB1cmw7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghdGhpcy51cmwpIHtcblx0XHRcdFx0cmVqZWN0KCdub3QgdXJsIHNwZWNpZmllZCcpO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblx0XHRcdHJlcS5vbmVycm9yID0gZSA9PiByZWplY3QoZSk7XG5cdFx0XHRyZXEub25sb2FkID0gKCkgPT4ge1xuXHRcdFx0XHR0aGlzLmNvbnRleHQuZGVjb2RlQXVkaW9EYXRhKHJlcS5yZXNwb25zZSwgYnVmZmVyID0+IHtcblx0XHRcdFx0XHR0aGlzLnNvdXJjZS5idWZmZXIgPSBidWZmZXI7XG5cblx0XHRcdFx0XHRyZXNvbHZlKHRoaXMuc291cmNlKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9O1xuXHRcdFx0cmVxLnJlc3BvbnNlVHlwZSA9ICdhcnJheWJ1ZmZlcic7XG5cdFx0XHRyZXEub3BlbignR0VUJywgdGhpcy51cmwsIHRydWUpO1xuXHRcdFx0cmVxLnNlbmQoKTtcblx0XHR9KTtcblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9hZCh1cmwsIG9wdHMgPSB7fSkge1xuXHRjb25zdCBsID0gbmV3IEF1ZGlvTG9hZGVyKHVybCwgb3B0cyk7XG5cdHJldHVybiBsLmxvYWQoKTtcbn1cbiJdLCJuYW1lcyI6WyJ0aGlzIiwiY29uc3QiXSwibWFwcGluZ3MiOiI7OztBQUVBLElBQU0sV0FBVyxHQUFDLG9CQUNOLENBQUMsR0FBRyxFQUFFLElBQVMsRUFBRTs0QkFBUCxHQUFHLEVBQUU7O0NBQzFCLElBQUssQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDOztDQUVoQixJQUFLLENBQUMsT0FBTyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7O0NBRW5DLElBQUssQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsQ0FBQztDQUMvQyxJQUFLLENBQUMsUUFBUSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO0NBQzVELElBQUssQ0FBQyxRQUFRLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFDLG9CQUFvQjtFQUM5RCxJQUFLLENBQUMsb0JBQW9CLEdBQUcsR0FBRyxDQUFDO0NBQ2xDLElBQUssQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7O0NBRWpELElBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0NBQ2pELElBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQzs7Q0FFcEMsSUFBSyxDQUFDLElBQUksR0FBRyxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLENBQUM7Q0FDNUQsQ0FBQTs7QUFFRixzQkFBQyxJQUFJLGtCQUFDLEdBQVEsRUFBRTtvQkFBUDsyQkFBQSxHQUFHLEVBQUU7O0NBQ2IsT0FBUSxJQUFJLE9BQU8sQ0FBQyxVQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUU7RUFDckMsSUFBSyxHQUFHLElBQUlBLE1BQUksQ0FBQyxHQUFHLEtBQUssR0FBRyxFQUFFO0dBQzdCLE1BQUssQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO0dBQ2Y7O0VBRUYsSUFBSyxDQUFDQSxNQUFJLENBQUMsR0FBRyxFQUFFO0dBQ2YsTUFBTyxDQUFDLG1CQUFtQixDQUFDLENBQUM7R0FDNUI7O0VBRUYsSUFBTyxHQUFHLEdBQUcsSUFBSSxjQUFjLEVBQUUsQ0FBQztFQUNsQyxHQUFJLENBQUMsT0FBTyxHQUFHLFVBQUEsQ0FBQyxFQUFDLFNBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFBLENBQUM7RUFDOUIsR0FBSSxDQUFDLE1BQU0sR0FBRyxZQUFHO0dBQ2hCLE1BQUssQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsVUFBQSxNQUFNLEVBQUM7SUFDbEQsTUFBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDOztJQUU3QixPQUFRLENBQUNBLE1BQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNyQixDQUFDLENBQUM7R0FDSCxDQUFDO0VBQ0gsR0FBSSxDQUFDLFlBQVksR0FBRyxhQUFhLENBQUM7RUFDbEMsR0FBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUVBLE1BQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUM7RUFDakMsR0FBSSxDQUFDLElBQUksRUFBRSxDQUFDO0VBQ1gsQ0FBQyxDQUFDO0NBQ0gsQ0FBQTs7QUFHRixBQUFPLFNBQVMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFTLEVBQUU7NEJBQVAsR0FBRyxFQUFFOztDQUNsQ0MsSUFBTSxDQUFDLEdBQUcsSUFBSSxXQUFXLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0NBQ3JDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0NBQ2hCOzs7OyJ9
